<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body>
  <script src="https://meet.jit.si/external_api.js"></script>
  <script>
    (async function() {
      // Get first video input device label
      const key = 'firstVideoInputDeviceLabel';
      const firstVideoInputDeviceLabel = new URLSearchParams(location.search).get(key);
      if (!firstVideoInputDeviceLabel) {
        // if not defined in URL - get it from navigator.mediaDevices, and then redirect to URL with it
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
        const devices = await navigator.mediaDevices.enumerateDevices();
        const videoInputDevices = devices.filter(device => device.kind === 'videoinput');
        const firstVideoInputDeviceLabel = videoInputDevices[0]?.label;
        if (!firstVideoInputDeviceLabel) {
          alert('Cannot find video input device');
          return;
        }
        location.search = '?' + key + '=' + encodeURIComponent(firstVideoInputDeviceLabel);
        return;
      }
      console.log('firstVideoInputDeviceLabel:' + firstVideoInputDeviceLabel);

      // Initialize Jitsi Meet with preselected video input device
      const domain = '8x8.vc';
      const jwt = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InZwYWFzLW1hZ2ljLWNvb2tpZS1mOTZiMTlmZjBlMjE0ZWUxYThhZDAxNGI2NzJlNTExNi80NTE3YWMifQ.eyJyb29tIjoidGVzdC10LTIwMjMtMTAtMjYiLCJjb250ZXh0Ijp7InVzZXIiOnsiaWQiOiJndWVzdC10ZXN0LWphYXMiLCJuYW1lIjoiQWxleGFuZGVyIiwiYXZhdGFyIjoiIiwiZW1haWxJZCI6Imd1ZXN0LXRlc3QtamFhc0B1c2VyLnRlZW15Y28iLCJtb2RlcmF0b3IiOiJ0cnVlIn0sImZlYXR1cmVzIjp7ImxpdmVzdHJlYW1pbmciOiJ0cnVlIiwicmVjb3JkaW5nIjoidHJ1ZSJ9fSwibmJmIjoxNjk4NjU0ODA5LCJleHAiOjE5MDY3MDI5NzAsImF1ZCI6ImppdHNpIiwiaXNzIjoiY2hhdCIsInN1YiI6InZwYWFzLW1hZ2ljLWNvb2tpZS1mOTZiMTlmZjBlMjE0ZWUxYThhZDAxNGI2NzJlNTExNiJ9.i3raKJlEd_MLZ-2QW-3GEkBo9o2FZQ7m89b33QpX9dTHUWgQEO_GuRx5Jp0_CJDJnuF2EIJi11ymTjw2740q-BProaPAVqslNeh88zMlIJC-dCHzYFSvnZZ3YYPJ30bbosx0Ys1mkMiVst7Q1eji64Jkf6gg4Pt2dFxcAsj9GuhGXZ1X71OGL_8YiywwSJQrusCobWlkuYFCrp0pKj3aBWp9PVPnemx4KWom3rEIcHTlv1Det5cHPUM8BYQYm5N333XZfGBMsz_9604YtgZjXQUTmtQTxREt7Q4_UBM_w63hom7ci-fJc1Cu5j8Phl2mjld0LX9NKIrRzUIcGmBfmRvZ0KBG1SnHBhZC0-VvfKkqGtruX1Gq97_Aom6ymvrLWwzWOzAA7t53871C2ug3rEh5eOubhzcch-kwHanuYAtWXeNg0Jgb3PtV5RF2dhTjfI4jnbdy5_D5jLLvU3ZHOXe-IYL7HreSJ3QPbMTzWyaFhVGxa-Rr7t1DqpfQ2hKl-hEiobGn1InXfK5BMHbIhtrFGnb-kIzrA3woTS9PGolCPkjIKb1eevG-A3Kxs0PDY-AqALH4nHwI2x8DOzWC290MskM6f_p8Bjb-jBZVCSzamYE_vrs6rmDTwQZ97c_dDQjRSA5rw5wK0r0GVOZqOh3b1n_1dHzabiviZhkhMNA';
      const options = {
        roomName: 'vpaas-magic-cookie-f96b19ff0e214ee1a8ad014b672e5116/test-t-2023-10-26',
        width: '100%',
        height: 500,
        configOverwrite: { prejoinPageEnabled: false, deeplinking: { disabled: true } },
        devices: { videoInput: firstVideoInputDeviceLabel },
        jwt,
      };
      const api = new JitsiMeetExternalAPI(domain, options);
    })();
  </script>
</body>
</html>
